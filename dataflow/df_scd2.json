{
	"name": "df_scd2",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_emp_data_src",
						"type": "DatasetReference"
					},
					"name": "sourceDataFromBlob"
				},
				{
					"dataset": {
						"referenceName": "SqlServerTable",
						"type": "DatasetReference"
					},
					"name": "sourceSQLserver"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "SqlServerTable",
						"type": "DatasetReference"
					},
					"name": "sinkSQLserver"
				},
				{
					"dataset": {
						"referenceName": "SqlServerTable",
						"type": "DatasetReference"
					},
					"name": "sinkUpdate"
				}
			],
			"transformations": [
				{
					"name": "DerivedColumnFlag"
				},
				{
					"name": "SelectChangeCol"
				},
				{
					"name": "LookupFromTgt"
				},
				{
					"name": "FilterExistingData"
				},
				{
					"name": "SelectLoseSourceCols"
				},
				{
					"name": "DerivedColumnSetFlag"
				},
				{
					"name": "AlterRowMarkUpdate"
				}
			],
			"script": "source(output(\n\t\tempid as integer,\n\t\tempname as string,\n\t\tgender as string,\n\t\tcountry as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> sourceDataFromBlob\nsource(output(\n\t\tsk_id as integer,\n\t\tempid as integer,\n\t\tempname as string,\n\t\tgender as string,\n\t\tcountry as string,\n\t\tisactive as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> sourceSQLserver\nsourceDataFromBlob derive(isActive = 1) ~> DerivedColumnFlag\nsourceSQLserver select(mapColumn(\n\t\tSQL_sk_id = sk_id,\n\t\tSQL_empid = empid,\n\t\tSQL_empname = empname,\n\t\tSQL_gender = gender,\n\t\tSQL_country = country,\n\t\tSQL_isactive = isactive\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectChangeCol\nsourceDataFromBlob, SelectChangeCol lookup(empid == SQL_empid,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupFromTgt\nLookupFromTgt filter(not(isNull(SQL_empid))) ~> FilterExistingData\nFilterExistingData select(mapColumn(\n\t\tSQL_sk_id,\n\t\tSQL_empid,\n\t\tSQL_empname,\n\t\tSQL_gender,\n\t\tSQL_country,\n\t\tSQL_isactive\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectLoseSourceCols\nSelectLoseSourceCols derive(SQL_isactive = 0) ~> DerivedColumnSetFlag\nDerivedColumnSetFlag alterRow(updateIf(1==1)) ~> AlterRowMarkUpdate\nDerivedColumnFlag sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tsk_id as integer,\n\t\tempid as integer,\n\t\tempname as string,\n\t\tgender as string,\n\t\tcountry as string,\n\t\tisactive as integer\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sinkSQLserver\nAlterRowMarkUpdate sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tsk_id as integer,\n\t\tempid as integer,\n\t\tempname as string,\n\t\tgender as string,\n\t\tcountry as string,\n\t\tisactive as integer\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['SQL_sk_id'],\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tsk_id = SQL_sk_id,\n\t\tempid = SQL_empid,\n\t\tempname = SQL_empname,\n\t\tgender = SQL_gender,\n\t\tcountry = SQL_country,\n\t\tisactive = SQL_isactive\n\t)) ~> sinkUpdate"
		}
	}
}